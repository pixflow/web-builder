(function($,karmaBuilder){karmaBuilder.elementPanel=Backbone.View.extend({flyScroll:"",events:{"click .element-panel-add-element-button":"openAddElementView",click:"stopClickInPanel","karma/after/finish_element_panel":"initDraggable","mousedown .karma-element-panel-list .karma-element-single-element":"addGrabHandler","mouseup .karma-element-panel-list .karma-element-single-element":"removeGrabHandler"},initialize:function(){this.setElement($('<div class="karma-element-panel-container">'));this.render();this.createAddElementPanel();this.createTemplatesPanel();this.createUnsplashPanel();this.closeElementPanel();this.$el.trigger("karma/after/finish_element_panel",[this])},stopClickInPanel:function(e){e.stopPropagation()},render:function(){document.body.appendChild(this.el)},createAddElementPanel:function(){var templateParams={};templateParams["elementInfo"]=KarmaView.getElementInfo();var template="<div>"+KarmaView.getWpTemplate("karma-element-panel-add-element",templateParams)+"</div>";this.el.appendChild($(template)[0])},createTemplatesPanel:function(){var template="<div>"+KarmaView.getWpTemplate("karma-element-panel-templates",{})+"</div>";this.el.appendChild($(template)[0])},createUnsplashPanel:function(){var template="<div>"+KarmaView.getWpTemplate("karma-element-panel-unsplash",{})+"</div>";this.el.appendChild($(template)[0])},openAddElementView:function(){var addElement=document.querySelector(".karma-element-panel-add-element-view");if(null!=addElement){addElement.classList.add("element-panel-show")}},closeElementPanel:function(){$(document).on("click",function(){var addElement=document.querySelector(".karma-element-panel-add-element-view");if(null!=addElement){addElement.classList.remove("element-panel-show")}})},addGrabHandler:function(e){var target=$(e.target);if(target.hasClass("karma-element-single-element")){target.addClass("karma-grab-element")}else{target.closest(".karma-element-single-element").addClass("karma-grab-element")}},removeGrabHandler:function(e){var target=$(e.target);if(target.hasClass("karma-element-single-element")){target.removeClass("karma-grab-element")}else{target.closest(".karma-element-single-element").removeClass("karma-grab-element")}},scroll:function(element){var element=element.helper,toolbarHeight=100;this.scrollToDown(element,toolbarHeight);this.scrollToTop()},scrollToDown:function(element,toolbarHeight){var that=this;if(element.position().top+toolbarHeight>window.innerHeight+$(window).scrollTop()){clearInterval(that.flyScroll);that.flyScroll=setInterval(function(){if(window.innerHeight+window.scrollY==document.body.offsetHeight){clearInterval(that.flyScroll)}$(window).scrollTop($(window).scrollTop()+5)},1)}else{clearInterval(that.flyScroll)}},scrollToTop:function(){var that=this;if(event.clientY<100){clearInterval(that.flyScroll);that.flyScroll=setInterval(function(){if($(window).scrollTop()==0){clearInterval(that.flyScroll)}$(window).scrollTop($(window).scrollTop()-5)},1)}},initDraggable:function(){var that=this;$(".karma-element-single-element").draggable({appendTo:"body",containment:"document",zIndex:9999999,cursorAt:{top:20,left:50},helper:"clone",start:function(){var DOMOBJ=$(this).get(0);DOMOBJ.classList.add("karma-start-dragging","karma-grab-element")},drag:function(event,UI){that.scroll(UI)},stop:function(){var DOMOBJ=$(this).get(0);DOMOBJ.classList.remove("karma-start-dragging","karma-grab-element");clearInterval(that.flyScroll)}})}})})(jQuery,karmaBuilder);