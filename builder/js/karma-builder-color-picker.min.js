var $=jQuery,karmaColorPicker=function(options){this.options={};this.defaultOptions={selector:".karma-color-picker",color:"#000000",opacity:true,multiColor:true,firstColorTitle:"Main",secondColorTitle:"Hover",presetColors:["#FFFFFF","#FEF445","#FAC711","#F24726","#E6E6E6","#CEE741","#8FD14F","#DA0263","#808080","#13CDD4","#0DA789","#652CB3","#141414","#2D9BF0","#404BB2"]};for(var i in this.defaultOptions){if(options.hasOwnProperty(i)){this.options[i]=options[i]}else{this.options[i]=this.defaultOptions[i]}}var element=document.querySelector(this.options.selector);if(element==null||$(element).hasClass("karma-color-picker-input")){return}this.mainInput=document.querySelector(this.options.selector);this.mainInput.value=this.options.color;this.generateColorPickerID();this.init()};karmaColorPicker.prototype.generateColorPickerID=function(){var found=true;do{var uniqueID=(new Date).valueOf();if(document.querySelector(".color-picker-"+uniqueID)==null){found=false}}while(found);this.id=uniqueID};karmaColorPicker.prototype.init=function(){var that=this;this.createColorPickerIcon();this.createColorPickerPopup();this.setMainInputEvent();this.chooseColorEvent();var handler=that.openColorPicker.bind(that);jQuery(document.querySelector(this.selector)).on("click.karma-color-picker",handler)};karmaColorPicker.prototype.createColorPickerIcon=function(){var that=this;var icon=document.createElement("div");icon.setAttribute("class","karma-color-picker-icon");icon.dataset.colorPickerId=this.id;this.icon=icon;var input=document.querySelector(this.options.selector);input.dataset.colorPickerId=this.id;icon.style.background=input.value;input.parentElement.insertBefore(icon,input);input.className+=" karma-color-picker-input";icon.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();that.openColorPicker(e)},true)};karmaColorPicker.prototype.createColorPickerPopup=function(){var that=this;var popup=document.createElement("div");popup.setAttribute("class","karma-color-picker-container");popup.dataset.colorPickerId=this.id;if(this.options.multiColor){var colorMode=document.createElement("div");colorMode.setAttribute("class","karma-color-picker-mode");var firstColor=document.createElement("span");firstColor.setAttribute("class","first-color active");firstColor.innerText=this.options.firstColorTitle;colorMode.appendChild(firstColor);var secondColor=document.createElement("span");secondColor.setAttribute("class","second-color");secondColor.innerText=this.options.secondColorTitle;colorMode.appendChild(secondColor);popup.appendChild(colorMode)}var presetColors=document.createElement("div");presetColors.setAttribute("class","karma-color-picker-preset-colors");for(var i=0;that.options.presetColors.length>i;i++){var presetColor=document.createElement("span");presetColor.setAttribute("class","karma-color-picker-preset-color");presetColor.style.backgroundColor=that.options.presetColors[i];this.presetColorsEvent(presetColor);presetColors.appendChild(presetColor)}var chooseColor=document.createElement("span");chooseColor.setAttribute("class","karma-color-picker-preset-color karma-color-picker-choose-color");var chooseColorInput=document.createElement("input");chooseColorInput.setAttribute("id",that.id);chooseColorInput.setAttribute("class","karma-color-picker-input");chooseColor.appendChild(chooseColorInput);that.chooseColor=chooseColor;presetColors.appendChild(chooseColor);popup.appendChild(presetColors);var input=document.querySelector(this.options.selector);input.parentElement.insertBefore(popup,input);that.initSpectrumColorPicker()};karmaColorPicker.prototype.presetColorsEvent=function(el){var that=this;el.addEventListener("click",function(e){e.preventDefault();if($(e.target).hasClass("selected")||$(e.target).hasClass("temp-pallet")){return false}else{$(e.target).siblings().removeClass("selected");e.target.className+=" selected";that.updateMainColor(e.target.style.backgroundColor)}},true)};karmaColorPicker.prototype.setMainInputEvent=function(){var that=this;$(this.mainInput).on("change",function(){that.icon.style.background=this.value})};karmaColorPicker.prototype.chooseColorEvent=function(){var that=this;$(that.chooseColor).on("click",function(e){e.preventDefault();e.stopPropagation();var $spectrum=$("#"+that.id);$spectrum.spectrum("set",that.mainInput.value);$spectrum.spectrum("toggle");that.addColorToPallet(that.mainInput.value);return false})};karmaColorPicker.prototype.addColorToPallet=function(color,addClass){var presetColor=document.createElement("span");presetColor.setAttribute("class","karma-color-picker-preset-color user-pallet temp-pallet");if(true===addClass){presetColor.classList.remove("temp-pallet")}presetColor.style.backgroundColor=color;this.presetColorsEvent(presetColor);this.chooseColor.parentElement.insertBefore(presetColor,this.chooseColor)};karmaColorPicker.prototype.updateMainColor=function(newColor){$(this.mainInput).val(newColor).change()};karmaColorPicker.prototype.saveColors=function(color){if(typeof Storage!=="undefined"){var savedColors=null==localStorage.getItem("karmaColors")?[]:JSON.parse(localStorage.getItem("karmaColors"));if(true===savedColors.includes(color)){return}if(8==savedColors.length){savedColors.shift()}savedColors.push(color);localStorage.setItem("karmaColors",JSON.stringify(savedColors))}};karmaColorPicker.prototype.initSpectrumColorPicker=function(){var that=this;$("#"+this.id).spectrum({color:that.options.color,showAlpha:that.options.opacity,alphaVertical:true,preferredFormat:"hex",showInput:true,replacerClassName:"spectrum-color-preview",move:function(color){if(null!=document.querySelector('.karma-color-picker-container[data-color-picker-id="'+that.id+'"] .temp-pallet')){$('.karma-color-picker-container[data-color-picker-id="'+that.id+'"] .selected').removeClass("selected");document.querySelector('.karma-color-picker-container[data-color-picker-id="'+that.id+'"] .temp-pallet').className+=" selected";$('.karma-color-picker-container[data-color-picker-id="'+that.id+'"] .temp-pallet').removeClass("temp-pallet")}document.querySelector('.karma-color-picker-container[data-color-picker-id="'+that.id+'"] .selected').style.backgroundColor=color;that.updateMainColor(color)},hide:function(color){that.saveColors(color.toHexString())}});$(document).off("click.hideColorPickerContainer").on("click.hideColorPickerContainer",function(){$(".karma-color-picker-container").removeClass("opened")});$(".karma-color-picker-container").off("click.hideColorPicker").on("click.hideColorPicker",function(){$(".temp-pallet").remove();$("#"+that.id).spectrum("hide")})};karmaColorPicker.prototype.openColorPicker=function(e){e.preventDefault();var colorPickerContaner=document.querySelector('.karma-color-picker-container[data-color-picker-id="'+e.target.dataset.colorPickerId+'"]'),that=this;if($(colorPickerContaner).hasClass("opened")){$(colorPickerContaner).removeClass("opened")}else{if(typeof Storage!=="undefined"){$(".karma-color-picker-preset-color.user-pallet").remove();var savedColors=null==localStorage.getItem("karmaColors")?[]:JSON.parse(localStorage.getItem("karmaColors"));_.each(savedColors,function(color){that.addColorToPallet(color,true)})}colorPickerContaner.className+=" opened"}};