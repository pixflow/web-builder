karmaBuilder.section=karmaBuilder.shortcodes.extend({rowGimzoParams:{},events:{click:"showBorder","mousedown .section-spacing":"showMouseToolTip","mousedown .row-top-spacing-dot-container":"showMouseToolTip","mousedown .row-bottom-spacing-dot-container":"showMouseToolTip"},initialize:function(options){karmaBuilder.row.__super__.initialize.apply(this,arguments);this.rowGimzoParams=options.gimzoParams[0];this.liveSpacing()},showSettingPanel:function(){console.log(this.model);this.model.attributes.shortcode_attributes["add_grid"]=this.currentGrid();karmaBuilder.row.__super__.showSettingPanel.apply(this,arguments)},createGizmo:function(){this.$el.append($(this.gizmoBuilder(this.rowGimzoParams)))},showBorder:function(){$(".karma-active-section").removeClass("karma-active-section");this.$el.addClass("karma-active-section")},currentGrid:function(){var childrenModels=this.findChildren();var currentGrid=[];for(var i=0,len=childrenModels.length;i<len;i++){currentGrid.push(parseInt(childrenModels[i].attributes.shortcode_attributes.sm_size))}return currentGrid},calculateNewGrid:function(){var newGrid=this.currentGrid();console.log(newGrid);newGrid.reverse();for(var i=0,len=newGrid.length;i<len;i++){if(newGrid[i]>1){newGrid[i]=parseInt(newGrid[i]-1);break}}newGrid.reverse();newGrid.push(1);console.log(newGrid);return newGrid},showMouseToolTip:function(e){var tooltipDiv=document.body.querySelector(".tooltip-div");tooltipDiv.style.display="block";e.target.classList.add("target-moving");document.documentElement.addEventListener("mousemove",this.moveMouseToolTip,false);document.documentElement.addEventListener("mouseup",this.removeMouseToolTip,false)},moveMouseToolTip:function(e){var tooltipDiv=document.body.querySelector(".tooltip-div");if("none"===tooltipDiv.style.display){return false}var x=e.clientX,y=e.clientY;tooltipDiv.style.top=y+20+"px";tooltipDiv.style.left=x-20+"px";tooltipDiv.innerText=document.querySelector(".target-moving").offsetHeight+" px"},removeMouseToolTip:function(e){var tooltipDiv=document.body.querySelector(".tooltip-div");tooltipDiv.style.display="none";e.target.classList.remove("target-moving");document.documentElement.removeEventListener("mousemove",this.moveMouseToolTip);document.documentElement.removeEventListener("mouseup",this.removeMouseToolTip)},toolTipHtml:function(){if(!document.querySelectorAll(".tooltip-div").length){var tooltip=document.createElement("div");tooltip.setAttribute("class","tooltip-div");document.body.appendChild(tooltip)}},spacingGizmo:function(){var rowTopSpacingContainer=document.createElement("div");rowTopSpacingContainer.setAttribute("class","row-top-spacing-dot-container");var rowTopSpacing=document.createElement("div");rowTopSpacing.setAttribute("class","spacing-top-dot-hover");var rowTopSpacingDot=document.createElement("div");rowTopSpacingDot.setAttribute("class","spacing-top-dot");rowTopSpacingContainer.appendChild(rowTopSpacingDot);rowTopSpacingContainer.appendChild(rowTopSpacing);var rowBottomSpacingContainer=document.createElement("div");rowBottomSpacingContainer.setAttribute("class","row-bottom-spacing-dot-container");var rowBottomSpacing=document.createElement("div");rowBottomSpacing.setAttribute("class","spacing-bottom-dot-hover");var rowBottomSpacingDot=document.createElement("div");rowBottomSpacingDot.setAttribute("class","spacing-bottom-dot");rowBottomSpacingContainer.appendChild(rowBottomSpacingDot);rowBottomSpacingContainer.appendChild(rowBottomSpacing);this.el.appendChild(rowTopSpacingContainer);this.el.appendChild(rowBottomSpacingContainer);var topSpacing=document.createElement("div");topSpacing.setAttribute("class","section-spacing section-top-spacing ui-resizable-handle ui-resizable-s ui-resizable-n");var bottomSpacing=document.createElement("div");bottomSpacing.setAttribute("class","section-spacing section-bottom-spacing ui-resizable-handle ui-resizable-s ui-resizable-n");this.el.appendChild(bottomSpacing);this.el.insertBefore(topSpacing,this.el.childNodes[0])},liveSpacing:function(){this.currentGrid();this.calculateNewGrid();this.spacingGizmo();this.toolTipHtml();var topSpacing=document.createElement("div");topSpacing.setAttribute("class","section-spacing section-top-spacing");var bottomSpacing=document.createElement("div");bottomSpacing.setAttribute("class","section-spacing section-bottom-spacing");this.el.appendChild(bottomSpacing);this.el.insertBefore(topSpacing,this.el.childNodes[0]);var that=this,options={selector:'[data-element-key="'+this.el.dataset.elementKey+'"] .section-spacing',minHeight:0,maxHeight:700,direction:"y",onDrag:function(el,value){var siblingSpacer=Array.prototype.filter.call(el.parentNode.children,function(child){return child!==el&&child.classList.contains("section-spacing")});siblingSpacer[0].style.height=value.height},onStop:function(value){that.setAttributes({space:parseInt(value.height)},true)}};gridResizer(options)}});