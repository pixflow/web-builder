(function($,karmaBuilder){karmaBuilder.imagebox=karmaBuilder.shortcodes.extend({events:{"blur .karma-image-text-box-title-tag ":"saveImageTitle","mousedown .karma-image-text-box-title-tag ":"changeImageTitle","keypress .karma-image-text-box-title-tag ":"changeClassImageTitle","blur .karma-image-text-box-description-tag":"saveImageDescription","mousedown .karma-image-text-box-description-tag ":"changeImageDescription","keypress .karma-image-text-box-description-tag":"changeClassImageDescription","keyup .karma-image-text-box-link-tag":"checkEmptyLink","click .karma-image-text-box-title":"titleEditable","click .karma-image-text-box-description":"titleDescription","click .karma-image-text-box-link":"titleLink","keypress .karma-image-text-box-link":"deactiveEnter"},initialize:function(options){karmaBuilder.imagebox.__super__.initialize.apply(this,arguments);this.options=options;if(this.options.renderStatus){this.render()}this.el.querySelector(".karma-image-text-box-link-tag").contentEditable=true;this.el.querySelector(".karma-image-text-box-description-tag ").contentEditable=true;this.el.querySelector(".karma-image-text-box-title-tag").contentEditable=true},render:function(){var source=this.template(this.model);this.el.querySelector(".karma-element-content").innerHTML=source},titleEditable:function(){var content=this.el.querySelector(".karma-image-text-box-title-tag");if(null!=content){if(document.body.classList.contains("karma-device-mode-desktop")){content.focus()}}},deactiveEnter:function(e){return e.which!=13},saveImageDescription:function(){var content=this.el.querySelector(".karma-image-text-box-description-tag"),contentData=content.innerText;if(""==contentData.trim()){content.innerText="Live Text Editor";content.classList.add("karma-image-box-description-opacity")}content.style.minWidth="0";if(""==contentData){this.setAttributes({descriptiontext:"Live Text Editor"},true)}else{this.setAttributes({descriptiontext:contentData},true)}},changeImageDescription:function(){var content=this.el.querySelector(".karma-image-text-box-description-tag"),contentData=content.innerText;if("Live Text Editor"==contentData.trim()){if(document.body.classList.contains("karma-device-mode-desktop")){content.style.minWidth="200px";content.innerHTML="&nbsp;"}}},changeClassImageDescription:function(){var content=this.el.querySelector(".karma-image-text-box-description-tag");if(content.classList.contains("karma-image-box-description-opacity")){content.className=content.className.replace("karma-image-box-description-opacity","")}},saveImageTitle:function(){var content=this.el.querySelector(".karma-image-text-box-title-tag"),contentData=this.el.querySelector(".karma-image-text-box-title-tag").innerText;if(""==contentData.trim()){content.innerText="Great idea";content.classList.add("karma-image-box-title-opacity")}if(""==contentData){this.setAttributes({titletext:"Great idea"},true)}else{this.setAttributes({titletext:contentData},true)}},changeImageTitle:function(){var content=this.el.querySelector(".karma-image-text-box-title-tag"),contentData=this.el.querySelector(".karma-image-text-box-title-tag").innerText;if("Great idea"==contentData.trim()){if(document.body.classList.contains("karma-device-mode-desktop")){content.innerHTML="&nbsp;"}}},changeClassImageTitle:function(){var content=this.el.querySelector(".karma-image-text-box-title-tag");if(null!=content){if(content.classList.contains("karma-image-box-title-opacity")){content.className=content.className.replace("karma-image-box-title-opacity","")}}},checkEmptyLink:function(){var content=this.el.querySelector(".karma-image-text-box-link-tag"),contentData=content.innerText;if(""==contentData.trim()){content.innerHTML="&nbsp;";this.el.querySelector(".karma-image-text-box-link-shape").style.display="none"}else{this.el.querySelector(".karma-image-text-box-link-shape").style.display="block"}this.setAttributes({linktext:contentData},true)},titleDescription:function(){var content=this.el.querySelector(".karma-image-text-box-description-tag");if(null!=content){if(document.body.classList.contains("karma-device-mode-desktop")){content.focus()}}},titleLink:function(){var content=this.el.querySelector(".karma-image-text-box-link-tag");if(null!=content){if(document.body.classList.contains("karma-device-mode-desktop")){content.focus()}}},backgroundsize:function(){var regex=new RegExp("(?:^|\\s)karma-image-text-box-background-size-(.*?)(?!\\S)"),backgroundsize=this.getAttributes(["backgroundsize"]).backgroundsize,sectionBackground=this.el.querySelector(".karma-image-text-box");sectionBackground.className=sectionBackground.className.replace(regex," karma-image-text-box-background-size-"+backgroundsize)},backgroundposition:function(){var regex=new RegExp("(?:^|\\s)karma-image-text-box-position-(.*?)(?!\\S)"),imagePosition=this.getAttributes(["backgroundposition"]);this.el.querySelector(".karma-image-text-box").className=this.el.querySelector(".karma-image-text-box").className.replace(regex," karma-image-text-box-position-"+imagePosition.backgroundposition)},imgurl:function(){var imageAddress=this.getAttributes(["imgurl"]),elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key");if("none"==imageAddress.imgurl){this.renderCss("#"+elementId+" .karma-image-box-background","background-image","none");this.renderCss("#"+elementId+" .karma-element-effect.karma-element-blur-effect","background-image","none")}else{this.renderCss("#"+elementId+" .karma-image-box-background","background-image","url("+imageAddress.imgurl+")");this.renderCss("#"+elementId+" .karma-element-effect.karma-element-blur-effect","background-image","url("+imageAddress.imgurl+")")}},titlecolor:function(){var elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key"),colorValue=this.getAttributes(["titlecolor"]);this.renderCss("#"+elementId+" .karma-image-text-box-title .karma-image-text-box-title-tag","color",colorValue.titlecolor)},descriptioncolor:function(){var elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key"),colorValue=this.getAttributes(["descriptioncolor"]);this.renderCss("#"+elementId+" .karma-image-text-box-description .karma-image-text-box-description-tag","color",colorValue.descriptioncolor)},linkcolor:function(){var elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key"),colorValue=this.getAttributes(["linkcolor"]);this.renderCss("#"+elementId+" .karma-image-text-box-link .karma-image-text-box-link-shape svg * ","stroke",colorValue.linkcolor)},radiusbox:function(){var elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key"),radiusBox=this.getAttributes(["radiusbox"]);this.renderCss("#"+elementId+" .karma-image-box-background-container","border-radius",radiusBox.radiusbox+"px");this.renderCss("#"+elementId+" .karma-element-effect","border-radius",radiusBox.radiusbox+"px")},imageheight:function(){var elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key"),imageHeight=this.getAttributes(["imageheight"]);this.renderCss("#"+elementId+" .karma-image-text-box ","height",imageHeight.imageheight+"px");this.renderCss("#"+elementId+" .karma-image-text-box ","min-height",imageHeight.imageheight*70/100+"px","tablet");this.renderCss("#"+elementId+" .karma-image-text-box ","min-height",imageHeight.imageheight*70/100+"px","mobile")},textlink:function(){var elementId=this.$el,linkValue=this.getAttributes(["textlink"]);elementId.find(".karma-image-text-box-link-tag").attr("href",linkValue.textlink)},target:function(){var elementId=this.$el,linktarget=this.getAttributes(["target"]);elementId.find(".karma-image-text-box-link-tag ").attr("target",linktarget.target)},titletag:function(){var element=this.el.querySelector(".karma-image-text-box-title-tag"),tagAttr=this.getAttributes(["titletag"]),newTag=document.createElement(tagAttr.titletag);newTag.innerHTML=element.innerHTML;newTag.contentEditable=true;newTag.classList.add("karma-image-text-box-title-tag");element.parentNode.replaceChild(newTag,element)},descriptiontag:function(){var element=this.el.querySelector(".karma-image-text-box-description-tag"),tagAttr=this.getAttributes(["descriptiontag"]),newTag=document.createElement(tagAttr.descriptiontag);newTag.innerHTML=element.innerHTML;newTag.contentEditable=true;newTag.classList.add("karma-image-text-box-description-tag");element.parentNode.replaceChild(newTag,element)},linktag:function(){var element=this.el.querySelector(".karma-image-text-box-link-tag"),tagAttr=this.getAttributes(["linktag"]),newTag=document.createElement(tagAttr.linktag);newTag.innerHTML=element.innerHTML;newTag.contentEditable=true;newTag.classList.add("karma-image-text-box-link-tag");element.parentNode.replaceChild(newTag,element)},textposition:function(){var dataValue=this.getAttributes(["textposition"]),regex=new RegExp("(?:^|\\s)karma-image-text-box-content-position-(.*?)(?!\\S)");this.el.querySelector(".karma-image-text-box").className=this.el.querySelector(".karma-image-text-box").className.replace(regex," karma-image-text-box-content-position-"+dataValue.textposition)},backgroundcolor:function(){var elementId=this.elementSelector();this.renderCss("#"+elementId+" .karma-image-box-background","background-color",this.getAttributes(["backgroundcolor"]).backgroundcolor)},overlaycolor:function(){var elementId=this.elementSelector();this.renderCss("#"+elementId+" .karma-image-text-box-overlay","background-color",this.getAttributes(["overlaycolor"]).overlaycolor)},type:function(){var className=this.getAttributes(["type"]).type;if("outline"==className){this.$el.find(".karma-image-text-box-link").removeClass("karma-button-fill karma-button-link").addClass("karma-button-outline")}else if("fill"==className){this.$el.find(".karma-image-text-box-link").addClass("karma-button-fill").removeClass("karma-button-outline karma-button-link")}else{this.$el.find(".karma-image-text-box-link").addClass("karma-button-link").removeClass("karma-button-outline karma-button-fill")}},rangemodel:function(){var elementId=this.el.getAttribute("data-name").replace(/_/g,"-")+"-"+this.el.getAttribute("data-element-key"),border=this.getAttributes(["rangemodel"]);this.renderCss("#"+elementId+" .karma-image-text-box-link","border-radius",border.rangemodel+"px")},textcolor:function(){var elementId=this.elementSelector(),colorValue=this.getAttributes(["textcolor"]);this.renderCss("#"+elementId+" .karma-button-fill .karma-image-text-box-link-tag ","color",colorValue.textcolor)},generalcolor:function(){var elementId=this.elementSelector(),colorValue=this.getAttributes(["generalcolor"]);this.renderCss("#"+elementId+" .karma-image-text-box-link.karma-button-fill","background-color",colorValue.generalcolor);this.renderCss("#"+elementId+" .karma-button-outline .karma-image-text-box-link-tag","color",colorValue.generalcolor);this.renderCss("#"+elementId+" .karma-image-text-box-link.karma-button-outline","border-color",colorValue.generalcolor);this.renderCss("#"+elementId+" .karma-image-text-box-link.karma-button-fill","border-color",colorValue.generalcolor);this.renderCss("#"+elementId+" .karma-image-text-box-link .karma-image-text-box-link-shape svg *","stroke",colorValue.generalcolor);this.renderCss("#"+elementId+" .karma-image-text-box-link.karma-button-link .karma-image-text-box-link-tag","color",colorValue.generalcolor)},visibleondesktop:function(){var desktopVisible=this.getAttributes(["visibleondesktop"]).visibleondesktop;if("on"==desktopVisible){this.el.querySelector(".karma-image-text-box-link").classList.remove("karma-deactive-on-desktop")}else{this.el.querySelector(".karma-image-text-box-link").classList.add("karma-deactive-on-desktop")}},visibleontablet:function(){var tabletVisible=this.getAttributes(["visibleontablet"]).visibleontablet;if("on"==tabletVisible){this.el.querySelector(".karma-image-text-box-link").classList.remove("karma-deactive-on-tablet")}else{this.el.querySelector(".karma-image-text-box-link").classList.add("karma-deactive-on-tablet")}},visibleonmobile:function(){var mobileVisible=this.getAttributes(["visibeonmobile"]).visibleonmobile;if("on"==mobileVisible){this.el.querySelector(".karma-image-text-box-link").classList.remove("karma-deactive-on-mobile")}else{this.el.querySelector(".karma-image-text-box-link").classList.add("karma-deactive-on-mobile")}},removeAnimation:function(element,elementEffect){element.remove("karma-box-element-shadow");element.remove("karma-box-element-hover-shadow");element.add("karma-box-element-no-animation");elementEffect.remove("karma-element-shadow-effect");elementEffect.remove("karma-element-blur-effect");elementEffect.add("karma-element-no-effect")},addSimpleShadow:function(element,elementEffect){element.remove("karma-box-element-hover-shadow");element.remove("karma-box-element-no-animation");element.add("karma-box-element-shadow");elementEffect.remove("karma-element-blur-effect");elementEffect.remove("karma-element-no-effect");elementEffect.add("karma-element-shadow-effect")},addShahdowWithAnimation:function(element,elementEffect){element.remove("karma-box-element-shadow");element.remove("karma-box-element-no-animation");element.add("karma-box-element-hover-shadow");elementEffect.remove("karma-element-shadow-effect");elementEffect.remove("karma-element-no-effect");elementEffect.add("karma-element-blur-effect")},animation:function(){var animationEffect=this.getAttributes(["animation"]).animation,element=this.el.querySelector(".karma-image-text-box").classList,elementEffect=this.el.querySelector(".karma-element-effect").classList;if("none"==animationEffect){this.removeAnimation(element,elementEffect)}else if("simpleshadow"==animationEffect){this.addSimpleShadow(element,elementEffect)}else if("shadowwithanimation"==animationEffect){this.addShahdowWithAnimation(element,elementEffect)}}})})(jQuery,karmaBuilder);