(function($,karmaBuilder){karmaBuilder.column=karmaBuilder.shortcodes.extend({events:{click:"activeColumn"},initialize:function(options){karmaBuilder.section.__super__.initialize.apply(this,arguments);this.liveChangeGrid()},render:function(){var source=this.template(this.model);this.el.innerHTML=source;this.createGizmo();this.delegateEvents()},activeColumn:function(){if(this.$el.hasClass("karma-active-column")){return}$(".karma-active-column").removeClass("karma-active-column");this.$el.addClass("karma-active-column")},rightSpace:function(){var elementId=this.el.getAttribute("data-name").replace("_","-")+"-"+this.el.getAttribute("data-element-key"),padding=this.model.attributes.shortcode_attributes.space+"px";document.getElementById(elementId).innerHTML="."+elementId+"{ padding-right: "+padding+";}"},extraClass:function(){var elementClass=this.model.get("shortcode_name").replace("_","-")+"-"+this.model.attributes.shortcode_attributes.element_key,defaultClasses=elementClass+" karma-column  "+this.model.attributes.shortcode_attributes.extraClass;this.el.firstElementChild.setAttribute("class",defaultClasses)},liveChangeGrid:function(){var that=this,key=this.model.get("element_key");var changeGridOptions={selector:'.karma-builder-element[data-element-key="'+key+'"]',snapToGrid:true,gridPrefix:"karma-col-md",onStop:function(result){var newGrid=result.grid;that.newGrid(newGrid)}};gridResizer(changeGridOptions)},newGrid:function(newGrid){var newLayout=this.$el.parent().backboneView().currentGrid();newLayout[newGrid.currentColumnIndex]=newGrid.currentColumnWidth;newLayout[newGrid.nextColumnIndex]=newGrid.nextColumnWidth;this.$el.parent().backboneView().changeRowLayout(newLayout)},changeColumnClassName:function(gridType,newCol){var regex=new RegExp("(?:^|\\s)karma-col-"+gridType+"-(.*?)(?!\\S)"),childCol=this.el.querySelector(".karma-column");this.el.className=this.el.className.replace(regex," karma-col-"+gridType+"-"+newCol);childCol.className=childCol.className.replace(regex," karma-col-"+gridType+"-"+newCol)},lg_size:function(){var newCol=this.model.attributes.shortcode_attributes.lg_size;this.changeColumnClassName("lg",newCol)},md_size:function(){var newCol=this.model.attributes.shortcode_attributes.md_size;this.changeColumnClassName("md",newCol)},xl_size:function(){var newCol=this.model.attributes.shortcode_attributes.xl_size;this.changeColumnClassName("xl",newCol)},sm_size:function(){var newCol=this.model.attributes.shortcode_attributes.sm_size;this.changeColumnClassName("sm",newCol)},updateWidthColumn:function(value){var newAttributes={sm_size:value,lg_size:value,md_size:value,xl_size:value};this.setAttributes(newAttributes,false)},deleteColumn:function(lastColumnKey){var columnKey=this.model.attributes.element_key,models=karmaBuilder.karmaModels.where({parent_key:columnKey}),lastColChild=karmaBuilder.karmaModels.where({parent_key:lastColumnKey}),newOrder=1;if(lastColChild.length){newOrder=lastColChild.last().attributes.order+1}_.each(models,function(model){var newAtttibutes=JSON.parse(JSON.stringify(model.attributes.shortcode_attributes));newAtttibutes.order=newOrder;newOrder++;model.set({parent_key:lastColumnKey,shortcode_attributes:newAtttibutes},{silent:true})});this.moveContent(lastColumnKey);this.model.destroy()},moveContent:function(lastColumnKey){var contentWithData=this.el.querySelector(".karma-column").cloneNode(true);$('[data-element-key="'+lastColumnKey+'"]').find(".karma-column").append(contentWithData.innerHTML)}})})(jQuery,karmaBuilder);